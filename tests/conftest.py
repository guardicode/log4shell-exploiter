import sys
from pathlib import Path

import pytest
from unittest.mock import MagicMock  # noqa: E402

from monkeytypes import NetworkPort
from agentpluginapi import ITCPPortSelector  # noqa: E402


@pytest.fixture(scope="session")
def data_for_tests_dir(pytestconfig):
    return Path(pytestconfig.rootdir) / "tests" / "data_for_tests"


@pytest.fixture(scope="session")
def tcp_port_selector() -> ITCPPortSelector:
    tcp_port_selector = MagicMock(spec=ITCPPortSelector)
    tcp_port_selector.get_free_tcp_port.side_effect = (NetworkPort(p) for p in range(54321, 65536))
    return tcp_port_selector
